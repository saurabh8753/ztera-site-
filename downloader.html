<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>ZTERA â€“ TeraBox Inline Player</title>
<meta name="theme-color" content="#3248f5">

<!-- GA -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E6G38YDKRW"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config','G-E6G38YDKRW');
</script>

<!-- HLS -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{margin:0;font-family:Inter,system-ui;background:#eef3ff}
.wrap{max-width:980px;margin:30px auto;padding:16px}
.hero{text-align:center}
h1{color:#3248f5;font-size:38px}

.card{background:#fff;padding:22px;border-radius:20px}
input{width:100%;padding:14px;border-radius:14px;border:1px solid #ccc;font-size:16px}

.btn{margin-top:16px;padding:14px;border-radius:16px;background:#4f46e5;color:#fff;
font-size:18px;font-weight:700;border:0;width:100%;cursor:pointer}

/* LOADER */
.loading{
  margin-top:16px;
  text-align:center;
  font-weight:700;
  color:#3248f5;
  display:none
}
.loader-spin{
  width:28px;
  height:28px;
  border:3px solid #dbe6ff;
  border-top-color:#3248f5;
  border-radius:50%;
  margin:0 auto 8px auto;
  animation:spin 0.9s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* player */
.player{margin-top:22px;display:none}
video{width:100%;max-height:70vh;background:#000;border-radius:16px}

/* join button */
.join{
  margin:14px auto 0 auto;
  display:flex;
  justify-content:center;
}
.join a{
  display:inline-flex;align-items:center;gap:8px;
  padding:12px 22px;border-radius:30px;
  background:#229ED9;color:#fff;font-weight:700;
  text-decoration:none;
}

/* install badge */
#installBadge{
  position:fixed;right:20px;bottom:20px;
  background:#3248f5;color:#fff;padding:12px 18px;
  border-radius:50px;font-size:15px;cursor:pointer;
  display:none;z-index:9999;
  animation:pulse 1.4s infinite;
}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
</style>
</head>

<body>

<div id="installBadge">ðŸ“² Install ZTERA App</div>

<div class="wrap">

<header class="hero">
<h1>ZTERA â€“ Inline Video Player</h1>
<p>Auto-retry â€¢ No popup â€¢ Smooth Streaming</p>
</header>

<section class="card">

<input id="tbxUrl" placeholder="Paste Terabox link here">
<button class="btn" onclick="start()">â–¶ Play Video</button>

<!-- JOIN BUTTON -->
<div class="join">
  <a href="https://telegram.me/+-Qt0LAeB71E0ZTll" target="_blank">
    ðŸ“¢ Join for Updates
  </a>
</div>

<!-- ADS UNDER JOIN BUTTON -->
<div id="adsBoxTop" style="margin-top:14px;text-align:center">
  <script async data-cfasync="false"
   src="https://pl28188629.effectivegatecpm.com/9a259b450791fd97609d22be0d2f1525/invoke.js"></script>
  <div id="container-9a259b450791fd97609d22be0d2f1525"></div>
</div>

<!-- LOADING -->
<div id="loading" class="loading">
  <div class="loader-spin"></div>
  Fetching videoâ€¦ please wait
</div>

<div id="player" class="player">
  <video id="video" controls playsinline preload="auto"></video>
</div>

</section>

</div>

<script>
const API="https://iteraplay.in/api/fetch?url=";
let hls=null, retryTimer=null, stopped=false;

/******** CHROME-ONLY (BLOCK TELEGRAM WEBVIEW) ********/
(function(){
  const ua=navigator.userAgent.toLowerCase();
  if(ua.includes("telegram")){
    const url=location.href;
    const intent="intent://"+url.replace(/^https?:\/\//,"")+
      "#Intent;scheme=https;package=com.android.chrome;end";
    window.location.href=intent;
  }
})();

/******** START ********/
function start(){
  const link=tbxUrl.value.trim();
  if(link.length<10) return;

  stopped=false;
  player.style.display="none";
  loading.style.display="block";

  fetchUntilSuccess(link);
}

/******** AUTO-RETRY ********/
async function fetchUntilSuccess(link){
  if(stopped) return;

  try{
    const controller=new AbortController();
    setTimeout(()=>controller.abort(),10000);

    const res=await fetch(API+encodeURIComponent(link),
      {cache:"no-store",signal:controller.signal});

    if(!res.ok) throw new Error();
    const data=await res.json();
    if(data.status!=="success") throw new Error();

    const file=data.list[0];
    const stream=file.fast_stream_url?.["720p"]
      || file.fast_stream_url?.["360p"]
      || file.stream_url;

    playInline(stream);

    loading.style.display="none";
    player.style.display="block";
    stopped=true;

  }catch(e){
    retryTimer=setTimeout(()=>fetchUntilSuccess(link),2500);
  }
}

/******** PLAYER ********/
function playInline(url){
  if(hls){hls.destroy();hls=null;}

  if(url.includes(".m3u8")){
    if(video.canPlayType("application/vnd.apple.mpegurl")){
      video.src=url;
    }else if(Hls.isSupported()){
      hls=new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
    }
  }else{
    video.src=url;
  }
  video.load(); video.play().catch(()=>{});
}

/******** BOT AUTO-PLAY (?url=) ********/
(function(){
  const p=new URLSearchParams(location.search);
  const u=p.get("url");
  if(u){
    tbxUrl.value=decodeURIComponent(u);
    setTimeout(start,900);
  }
})();

/******** PWA BADGE ********/
let deferredPrompt;
const badge=document.getElementById("installBadge");

window.addEventListener("beforeinstallprompt",(e)=>{
  e.preventDefault();deferredPrompt=e;
  badge.style.display="block";
});
badge.onclick=async()=>{
  badge.style.display="none";
  if(!deferredPrompt)return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  setTimeout(()=>badge.style.display="block",15000);
};
</script>

</body>
</html>
