<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ZTERA ‚Äì TeraBox Inline Player</title>

<meta name="theme-color" content="#3248f5">
<link rel="manifest" href="manifest.json">

<!-- HLS.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{
  margin:0;
  font-family:Inter,system-ui;
  background:#eef3ff
}
.wrap{
  max-width:980px;
  margin:30px auto;
  padding:16px
}
.hero{text-align:center}
h1{color:#3248f5;font-size:38px}

.card{
  background:#fff;
  padding:22px;
  border-radius:20px
}
input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid #ccc;
  font-size:16px
}
.btn{
  margin-top:16px;
  padding:14px;
  border-radius:16px;
  background:#4f46e5;
  color:#fff;
  font-size:18px;
  font-weight:700;
  border:0;
  width:100%;
  cursor:pointer
}

.loading{
  margin-top:14px;
  text-align:center;
  font-weight:700;
  color:#3248f5;
  display:none
}
.error{
  margin-top:10px;
  color:#dc2626;
  font-weight:700;
  text-align:center;
  display:none
}
.player{
  margin-top:22px;
  display:none
}
video{
  width:100%;
  max-height:70vh;
  background:#000;
  border-radius:16px
}

/* Telegram Button */
.telegram-btn{
  margin:18px auto 0;
  display:flex;
  justify-content:center;
}
.telegram-btn a{
  padding:12px 26px;
  background:linear-gradient(135deg,#229ED9,#0A7CBA);
  color:#fff;
  border-radius:30px;
  font-weight:700;
  text-decoration:none;
  animation:pulseTG 1.6s infinite;
}
@keyframes pulseTG{
  0%{transform:scale(1)}
  50%{transform:scale(1.08)}
  100%{transform:scale(1)}
}

/* PWA Badge */
#installBadge{
  position:fixed;
  right:20px;
  bottom:20px;
  background:#3248f5;
  color:#fff;
  padding:12px 18px;
  border-radius:50px;
  font-size:16px;
  cursor:pointer;
  display:none;
  z-index:99999;
  animation:pulseTG 1.4s infinite;
}
</style>
</head>

<body>

<div id="installBadge">üì≤ Install ZTERA App</div>

<div class="wrap">
<header class="hero">
<h1>ZTERA ‚Äì Inline Video Player</h1>
<p>Auto-retry ‚Ä¢ No popup ‚Ä¢ Inline Play</p>
</header>

<section class="card">
<input id="tbxUrl" placeholder="Paste Terabox link here">
<button class="btn" onclick="start()">‚ñ∂ Play Video</button>

<!-- JOIN BUTTON (CENTER) -->
<div class="telegram-btn">
<a href="https://telegram.me/+-Qt0LAeB71E0ZTll"
   target="_blank"
   rel="noopener">
üì¢ Join for Updates
</a>
</div>

<div id="loading" class="loading">‚è≥ Fetching video‚Ä¶</div>
<div id="error" class="error"></div>

<div id="player" class="player">
  <video id="video" controls playsinline preload="auto"></video>

  <!-- ADS BELOW VIDEO -->
  <div style="margin-top:18px;text-align:center">
    <script async data-cfasync="false"
      src="https://pl28188629.effectivegatecpm.com/9a259b450791fd97609d22be0d2f1525/invoke.js">
    </script>
    <div id="container-9a259b450791fd97609d22be0d2f1525"></div>
  </div>
</div>
</section>
</div>

<script>
const API = "https://iteraplay.in/api/fetch?url=";
let hls=null, stopped=false;

/* START */
function start(){
  const link=tbxUrl.value.trim();
  if(link.length<10){ showError("Invalid TeraBox link"); return; }
  stopped=false;
  error.style.display="none";
  player.style.display="none";
  loading.style.display="block";
  fetchUntilSuccess(link);
}

/* AUTO RETRY */
async function fetchUntilSuccess(link){
  if(stopped) return;
  try{
    const controller=new AbortController();
    setTimeout(()=>controller.abort(),10000);
    const res=await fetch(API+encodeURIComponent(link),
      {cache:"no-store",signal:controller.signal});
    if(!res.ok) throw "";
    const data=await res.json();
    if(data.status!=="success") throw "";
    const f=data.list[0];
    const stream=f.fast_stream_url?.["720p"]||f.stream_url;
    playInline(stream);
    loading.style.display="none";
    player.style.display="block";
    stopped=true;
  }catch{
    error.textContent="Server busy‚Ä¶ retrying";
    error.style.display="block";
    setTimeout(()=>fetchUntilSuccess(link),2500);
  }
}

/* INLINE PLAY */
function playInline(url){
  if(hls){hls.destroy();hls=null;}
  if(url.includes(".m3u8")){
    if(video.canPlayType("application/vnd.apple.mpegurl")){
      video.src=url;
    }else if(Hls.isSupported()){
      hls=new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
    }
  }else video.src=url;
  video.play().catch(()=>{});
}
function showError(m){ error.textContent=m; error.style.display="block"; }

/* BOT AUTO PLAY (?url=) */
(function () {
  const params = new URLSearchParams(window.location.search);
  const botUrl = params.get("url");

  if (botUrl && botUrl.length > 10) {
    const input = document.getElementById("tbxUrl");
    const playBtn = document.getElementById("openVideo");

    if (input && playBtn) {
      input.value = decodeURIComponent(botUrl);
      setTimeout(() => {
        playBtn.click();
      }, 1200);
    }
  }
})();
/* PWA */
let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
 e.preventDefault(); deferredPrompt=e;
 installBadge.style.display="block";
});
installBadge.onclick=async()=>{
 if(!deferredPrompt) return;
 deferredPrompt.prompt();
 await deferredPrompt.userChoice;
};
</script>

</body>
</html>
