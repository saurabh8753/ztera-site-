<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ZTERA ‚Äì TeraBox Inline Player</title>

<meta name="theme-color" content="#3248f5">

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<!-- HLS.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{margin:0;font-family:Inter,system-ui;background:#eef3ff}
.wrap{max-width:980px;margin:30px auto;padding:16px}
.hero{text-align:center}
h1{color:#3248f5;font-size:38px}

.card{background:#fff;padding:22px;border-radius:20px}
input{width:100%;padding:14px;border-radius:14px;border:1px solid #ccc;font-size:16px}
.btn{
  margin-top:16px;padding:14px;border-radius:16px;
  background:#4f46e5;color:#fff;font-size:18px;
  font-weight:700;border:0;width:100%;cursor:pointer
}

.loading{text-align:center;font-weight:700;color:#3248f5;display:none;margin-top:14px}
.error{text-align:center;font-weight:700;color:#dc2626;display:none;margin-top:10px}
.player{margin-top:22px;display:none}
video{width:100%;max-height:70vh;background:#000;border-radius:16px}

/* üîî PWA BADGE */
#installBadge{
  position:fixed;right:18px;bottom:18px;
  background:#3248f5;color:#fff;
  padding:12px 18px;border-radius:40px;
  font-weight:700;cursor:pointer;
  display:none;z-index:9999;
  animation:pulse 1.4s infinite
}
@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.08)}
  100%{transform:scale(1)}
}

/* üì¢ Telegram Button */
.telegram-btn{
  display:inline-flex;align-items:center;gap:8px;
  padding:12px 22px;border-radius:30px;
  background:linear-gradient(135deg,#229ED9,#0A7CBA);
  color:#fff;font-weight:700;text-decoration:none;
  margin-top:16px;
  animation:tgPulse 1.6s infinite
}
@keyframes tgPulse{
  0%{box-shadow:0 0 0 rgba(34,158,217,.5)}
  70%{box-shadow:0 0 20px rgba(34,158,217,.9)}
  100%{box-shadow:0 0 0 rgba(34,158,217,.5)}
}

.article{
  margin-top:40px;background:#fff;
  padding:22px;border-radius:20px;
  line-height:1.7
}
.article h2{color:#3248f5}
</style>
</head>

<body>

<!-- üîî PWA INSTALL BADGE -->
<div id="installBadge">üì≤ Install App</div>

<div class="wrap">
<header class="hero">
<h1>ZTERA ‚Äì Inline Video Player</h1>
<p>Auto-retry enabled ‚Ä¢ No popup ‚Ä¢ No download</p>
</header>

<section class="card">
<input id="tbxUrl" placeholder="Paste Terabox link here">
<button class="btn" onclick="start()">‚ñ∂ Play Video</button>

<div id="loading" class="loading">‚è≥ Fetching video‚Ä¶ please wait</div>
<div id="error" class="error"></div>

<div id="player" class="player">
  <video id="video" controls playsinline preload="auto"></video>
</div>

<div style="text-align:center">
<a class="telegram-btn" href="https://telegram.me/+-Qt0LAeB71E0ZTll" target="_blank">
üì¢ Join for Updates
</a>
</div>
</section>

<!-- üìö SEO ARTICLE -->
<section class="article">
<h2>‚≠ê ZTERA ‚Äì Best TeraBox Online Player</h2>
<p>
ZTERA ek fast aur lightweight <b>TeraBox video player</b> hai jisse aap bina login
aur bina ads ke Terabox videos online dekh sakte ho.
</p>

<h2>‚≠ê Features</h2>
<ul>
<li>Instant HD playback</li>
<li>Auto retry on busy server</li>
<li>Mobile & desktop supported</li>
<li>No popup, no download</li>
</ul>

<h2>‚≠ê How to Use</h2>
<ol>
<li>Terabox link paste karo</li>
<li>Play Video button dabao</li>
<li>Video inline player me play ho jayegi</li>
</ol>

<h2>‚≠ê FAQ</h2>
<p><b>Q:</b> Kya ZTERA free hai?<br><b>A:</b> Haan, bilkul free.</p>
<p><b>Q:</b> Kya login chahiye?<br><b>A:</b> Nahi.</p>
</section>

</div>

<script>
/* ======================
   üîî PWA INSTALL LOGIC
====================== */
let deferredPrompt;
const badge=document.getElementById("installBadge");
window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();
  deferredPrompt=e;
  badge.style.display="block";
});
badge.onclick=async()=>{
  badge.style.display="none";
  if(!deferredPrompt)return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
};

/* ======================
   ü§ñ BOT AUTO PLAY LOGIC
====================== */
(function(){
  const p=new URLSearchParams(location.search);
  const u=p.get("url");
  if(u && u.length>10){
    tbxUrl.value=decodeURIComponent(u);
    setTimeout(()=>start(),1200);
  }
})();
</script>

<!-- ======================
   üîí PLAYER CODE (UNCHANGED)
====================== -->
<script>
const API = "https://iteraplay.in/api/fetch?url=";

let hls = null;
let retryTimer = null;
let stopped = false;

/* üöÄ START */
function start(){
  const link = tbxUrl.value.trim();
  if(link.length < 10){
    showError("Invalid TeraBox link");
    return;
  }

  stopped = false;
  error.style.display = "none";
  player.style.display = "none";
  loading.style.display = "block";

  fetchUntilSuccess(link);
}

/* üîÅ INFINITE AUTO RETRY */
async function fetchUntilSuccess(link){
  if(stopped) return;

  try{
    const controller = new AbortController();
    setTimeout(()=>controller.abort(), 10000);

    const res = await fetch(
      API + encodeURIComponent(link),
      { cache:"no-store", signal: controller.signal }
    );

    if(!res.ok) throw new Error();
    const data = await res.json();
    if(data.status !== "success") throw new Error();

    const file = data.list[0];
    const stream =
      file.fast_stream_url?.["720p"] ||
      file.fast_stream_url?.["360p"] ||
      file.stream_url;

    playInline(stream);

    loading.style.display = "none";
    player.style.display = "block";
    stopped = true;

  }catch(e){
    error.textContent="Server busy‚Ä¶ retrying automatically";
    error.style.display="block";
    retryTimer=setTimeout(()=>fetchUntilSuccess(link),2500);
  }
}

/* ‚ñ∂ INLINE PLAY */
function playInline(url){
  if(hls){hls.destroy();hls=null}
  if(url.includes(".m3u8")){
    if(video.canPlayType("application/vnd.apple.mpegurl")){
      video.src=url;
    }else if(Hls.isSupported()){
      hls=new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
    }
  }else{
    video.src=url;
  }
  video.load();
  video.play().catch(()=>{});
}

function showError(msg){
  error.textContent=msg;
  error.style.display="block";
}
</script>

</body>
</html>
